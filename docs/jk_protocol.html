<p><code>JK</code>と<code>おっさん</code>の間で、個人情報を一切漏らすことなく円滑なコミュニケーションが行えるように工夫したプロトコルです。現在は次の二つのプロトコルがありますが、ニーズに合わせてもっと色々考えたいと思っています。</p>
<h1>高校生判定プロトコル</h1>
<h2>登場人物</h2>
<p>ここには次のような登場人物がいると仮定します。</p>
<dl>
  <dt>JK</dt>
  <dd>自分が<strong>高校生</strong>であることを証明したいが名前や住所、所属する学校などは保護したい</dd>

  <dt>おっさん</dt>
  <dd>ある人間について、その人間の性別や年齢といった個人情報はどうでもいいが、<strong>高校生</strong>であるということは確定させたい</dd>
</dl>
<p>このような仮定があるので、例えば<code>JK</code>が、<code>JK</code>の所属する学校の発行する学生証を用いて<code>おっさん</code>に身分を示すということは、学校名などといった個人情報が流出するので使うことはできません。</p>
<h2>概要</h2>
<p>次のような構成になります。</p>
<ol>
<li><code>おっさん</code>は自分が <strong>信頼できる</strong> カラオケ・理髪店・映画館をいくつかピックアップして、そのリストを<code>JK</code>へ渡す</li>
<li><code>JK</code>は（1）で受け取ったリストの中から <strong>信頼できる</strong> お店を一つ選択する（もし信頼できるお店がリストにない場合は、<code>おっさん</code>がお店のリストを作り直す）</li>
<li><code>おっさん</code>と<code>JK</code>は（2）で指定したお店で待合せをして、<code>JK</code>はそのお店を <strong>高校生の価格</strong> で利用する（その際に学生証などを提示するが、<code>おっさん</code>は少し離れた場所に待機してもらい、学生証が店員にしか見えないようにする）</li>
<li><code>JK</code>はお店を高校生の価格で利用したことを示す証拠（レシートなど）を<code>おっさん</code>に提示する</li>
<li><code>おっさん</code>は（4）の証拠を確認する（レシートの日付けなど）</li>
</ol>
<p>この方法では、お店を<code>おっさん</code>と<code>JK</code>の両方が信頼しているので、お店を篭絡して<code>おっさん</code>が個人情報を取得するなどということはないといえます。 つまり、<code>JK</code>と<code>おっさん</code>はお互いを信用する（個人情報を渡す）かわりに、お店を信用することにしたということです。</p>
<h1>現金支払いプロトコル</h1>
<h2>登場人物</h2>
<p>ここには次のような登場人物がいると仮定します。</p>
<dl>
  <dt>JK</dt>
  <dd><code>おっさん</code>といちゃいちゃしてもよいから<strong>現金</strong>が欲しい

  <dt>おっさん</dt>
  <dd><code>JK</code>といちゃいちゃできたら<strong>現金</strong>を渡してもよい</dd>
</dl>
<h2>既存のプロトコル</h2>
<p>既存のプロトコルでは、次のような問題があります。</p>
<h3>現金前払い</h3>
<p>現金前払いとは次のようなプロトコルです。</p>
<ol>
<li><code>おっさん</code>が<code>JK</code>へ予め <strong>現金</strong> を渡す</li>
<li><code>おっさん</code>と<code>JK</code>がいちゃいちゃする</li>
</ol>
<p>ですが、このプロトコルでは<code>おっさん</code>が現金を<code>JK</code>へ渡した後、<code>JK</code>はいちゃいちゃする前に何らかの手段で現金を持って逃走する可能性があり、<code>おっさん</code>にとって不利です。</p>
<h3>現金後払い</h3>
<p>現金後払いとは次のようなプロトコルです。</p>
<ol>
<li><code>おっさん</code>と<code>JK</code>がいちゃいちゃする</li>
<li><code>おっさん</code>が<code>JK</code>へ <strong>現金</strong> を渡す</li>
</ol>
<p>しかし、この方法ではいちゃいちゃした後、<code>おっさん</code>が現金を払わない可能性があり、<code>JK</code>にとって不利です。</p>
<p>このように既存の方法では、現金の先払い後払いによって、悪意のある振る舞いをするとどちらかが有利になるという方法しかありませんでした。</p>
<h2>新しいプロトコル</h2>
<p>紙幣を破壊するので、次のようなルールが必要になります。</p>
<h3>紙幣が破損した場合の交換基準</h3>
<p>次のようなルールに基づいて、破損した紙幣を銀行などが交換してくれるものとします。</p>
<p>（引用：<a href="https://www.boj.or.jp/about/services/bn/sonsyo.htm/" class="uri">https://www.boj.or.jp/about/services/bn/sonsyo.htm/</a>）</p>
<blockquote>
<ul>
<li>面積が3分の2以上の場合は全額として引換え</li>
<li>面積が5分の2以上、3分の2未満の場合は半額として引換え</li>
<li>面積が5分の2未満の場合は銀行券としての価値は無く失効</li>
</ul>
</blockquote>
<h3>プロトコル</h3>
<p>次のように実行します。</p>
<ol>
<li><code>おっさん</code>は用意した <strong>現金</strong> （紙幣のみ）を<code>JK</code>へ見せて、本物かどうか確認してもらう</li>
<li>次のように、現金（紙幣）をカッターナイフなどで <strong>三等分</strong> に切断する <img src="https://qiita-image-store.s3.amazonaws.com/0/10815/1c161610-0207-2ee5-d7d6-9258bb954787.png" alt="yen.png" /></li>
<li>三等分にした現金の <strong>B</strong> の部分をライターなどで燃やして <strong>破棄</strong> する</li>
<li>三等分にした現金のうち <strong>A</strong> の部分を<code>JK</code>へ渡し、 <strong>C</strong> の部分を<code>おっさん</code>が持つ</li>
<li>いちゃいちゃする</li>
<li><code>おっさん</code>は持っている <strong>C</strong> の部分を<code>JK</code>へ渡す</li>
<li><code>JK</code>は後日、銀行へ行き、切断された紙幣 <strong>A</strong> と <strong>C</strong> を新品の現金に交換してもらう</li>
</ol>
<p>ここで$\frac{1}{3}$になった現金（紙幣）について考えます。$\frac{1}{3} \fallingdotseq 0.3$ですが、切断された現金が価値を持つには$\frac{2}{5} = 0.4$以上必要になります。つまり、切断された現金 <strong>A</strong> や <strong>C</strong> はそのままの状態ではゴミということになります。こうすると、<code>JK</code>は切断された現金 <strong>A</strong> を持って逃げても無駄ということになります。また、<code>おっさん</code>も切断された現金 <strong>C</strong> を持っていても意味がありません。</p>
<h1>FAQ</h1>
<p>もともと後輩に説明するために作ったこのページが、僕の予想に反してたくさんの方にご閲覧いただき、はてなブックマークやTwitterなどでいくつかのコメントをいただきました。その中で多いものなどをここで取り上げて僕の意見などを述べさせていただくことにします。</p>
<h2>限定公開にも関わらず、ソーシャルブックマークで拡散してしまったが良いのか？</h2>
<p>この記事はもともと後輩に説明するための記事ですが、特に隠すつもりはないので僕としてはOKだと思っています。限定公開としたのは、この記事が直ちに技術へ直結する内容を含んでいないという気持ちから、Qiitaにとってもしかしたら相応わしくないかなと思ったからです。</p>
<h2>これらのプロトコルに技術的なオチはないのか？</h2>
<p>これらのプロトコルには技術的に考える余地があると考えています。二つのプロトコルに分けて、それぞれ述べます。</p>
<h3>高校生判定プロトコルの技術的なオチ</h3>
<p>何人かの方々が指摘なさっているように、このプロトコルは <strong>OAuth</strong> や <strong>認証局</strong> がモデルになっています。技術分野の方々にとって、これらの技術を解説する必要はないかもしれないですが、僕なりに一応解説します。 例としてTwitterによる認証を考えます。するとプロトコルの登場人物などを次のように読み替えることができます。</p>
<ul>
<li><code>JK</code> → Webサイトの利用者</li>
<li><code>おっさん</code> → 利用するWebサイト</li>
<li>信頼できるお店 → Twitter</li>
<li>レシート → トークン</li>
</ul>
<p>メールアドレスなどの個人情報を渡して利用したいWebサイトがあるが、そのWebサイトに個人情報を渡すほどの信頼がないとき、Twitterなど信頼できる第三者に認証してもらい、Twitterが認証したという証拠をWebサイトにトークンという形で提示します。 このプロトコルを考える前から、僕はOAuthや認証局といった技術について知っていたので、これらの技術はこのプロトコルを考えるにあたって参考にしました。</p>
<p>また、一部ではこのプロトコルが <strong>ゼロ知識証明</strong> なのではないかという指摘がありますが、それは違うのではないかと僕は思います。ゼロ知識証明は具体的に色々な方法がありますが、どれも二者間で行うものであって、このプロトコルのように信頼できる第三者が登場することはないと思います。</p>
<h3>現金支払いプロトコルの技術的なオチ</h3>
<p>こちらについては、 <strong>閾値暗号</strong> というものを参考にしました。閾値暗号についてはWebにあまり文献がなく、また僕自身の理解もそれほどないのですが、参考程度に書いておきます。 直感的な議論をすると、鍵と鍵穴が$n$個ある南京錠があるとします。複数の鍵と鍵穴が錠を開けたり閉めたりする際に必要な南京錠は世の中にあると思いますが、そういう場合たいてい$n$個すべての鍵が必要になります。これに対して、$n$個の中からどんな組み合せでもよい$k\, (&lt;n)$個の鍵があれば鍵を開けたり閉めたりできる、というのが閾値暗号の特徴です。 これがあると何がよいのかというと、例えばたくさんの人数で暗号通信をしていて、参加者の皆が暗号鍵を持っているという状況を考えます。そこで、ネットワークのエラーなどが発生し参加者の中の一人が切断されたとすると、全ての鍵が必要な暗号を使っている場合、もう暗号を復活させたりする手段がなくなってしまいます。閾値暗号を使えば、少なくとも$k$人生き残っていれば暗号通信を継続することができます。一方で、もし$k$人がグルになってしまうと、暗号を解読することができるので、そういう対策が別途必要になるという側面も持ちます。 このように、$k$のようなある閾値があれば暗号を解読するなどできる（価値が生まれる）一方で、閾値を下回ると途端に価値がなくなってしまうものを探した結果、日本銀行が発行する紙幣は$k$が$\frac{2}{3}$以上の時に全ての価値を持ち、$k$が$\frac{2}{5}$を下回ると価値を失うという大変素晴しい性質を持つことに気がつき、今回利用させてもらいました。</p>
<h2>紙幣を切断するのは違法ではないのか？</h2>
<p>Wikipediaの<a href="http://ja.wikipedia.org/wiki/%E8%B2%A8%E5%B9%A3%E6%90%8D%E5%82%B7%E7%AD%89%E5%8F%96%E7%B7%A0%E6%B3%95">貨幣損傷等取締法</a>には次のような記述があるので問題はないと判断しました。</p>
<blockquote>
<p>日本銀行券（いわゆる紙幣）は本法の対象外である。貨幣の場合とは異なり、2008年現在、日本銀行券を損傷することそれ自体を罰する法律はない。</p>
</blockquote>
<h2>おっさんもJKも相手を損させる手段があるのではないか？</h2>
<p>その通りです。それは次のような方法を使えば可能です。</p>
<dl>
  <dt><code>JK</code>が<code>おっさん</code>を損させたい場合</dt>
  <dd>切断された現金 <strong>A</strong> を持って逃げる</dd>
  <dt><code>おっさん</code>が<code>JK</code>を損させたい場合</dt>
  <dd>切断された現金 <strong>C</strong> を渡さない</dd>
</dl>
<p>これの解決は今後の課題です。</p>
<h2>紙幣を三等分にするのは難しいのではないか？</h2>
<p>実はこのプロトコルでは紙幣を正確に三等分する必要はありません。切断された紙幣には次のような関係が成り立てばよいです。</p>
<ul>
<li>切断された紙幣 <strong>A</strong>、 <strong>B</strong>、<strong>C</strong> を全て足すと、それは$1$（元の紙幣）である</li>
<li>切断された紙幣 <strong>A</strong> と <strong>C</strong> は両方とも$\frac{2}{5}$未満である（紙幣としての価値を消滅させるため）</li>
<li>切断された紙幣 <strong>A</strong> と <strong>C</strong> を足すと、面積が$\frac{2}{3}$以上になる（<code>JK</code>が銀行で交換してもらうため）</li>
</ul>
<p>これを考えると、切断された紙幣 <strong>A</strong> と <strong>C</strong> が満すべき条件は、$\frac{1}{3}$以上$\frac{2}{5}$未満ということになります。つまり多少 <strong>B</strong> が小さくなっても問題はありません。</p>
<h2>登場人物はアリスとボブでよかったのではないか？</h2>
<p>次のJavaScriptで記事の中の<code>JK</code>と<code>おっさん</code>を全て<code>アリス</code>と<code>ボブ</code>に変換できます。</p>
<pre><code class="js">$('*').each( function() {
  var txt = $(this).html();
  $(this).html(txt.replace(/JK/g, 'アリス').replace(/おっさん/g, 'ボブ'));
} );</code></pre>
